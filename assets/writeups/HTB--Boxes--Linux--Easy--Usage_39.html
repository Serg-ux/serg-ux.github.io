<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Usage</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="../../assets/css/style.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Usage</h1><br/><p><ol><li>Realizo un escaneo de puertos <strong>nmap -sV -sC -p- --open 10.10.11.18 -oN scan.txt</strong></li><li>Encuentro el servicio <strong>SSH</strong> y <strong>HTTP</strong></li><li>Analizo la página y encuentro un login</li><li>arriba a la derecha hay un botón admin</li><li>si le doy click me redirige a al subdominio <strong>admin.usage.htb</strong></li><li>Los añado a<strong> /etc/hosts</strong></li><li>Me manda a un login de admin</li><li>Veo que no funcionan los credenciales ni nada</li><li>Al entrar en el directorio /forget-password si introduzco un email dice que no lo encontró en sus archivos</li><li>Por lo que parece que realiza una sentencia SQL</li><li>Voy a ver si con sqlmap puedo ver si es vulnerable a una SQLi</li><li>Con sqlmap no encuentro nada</li><li>Le doy una segunda oportunidad y me encuentra una sqli</li><li>Obtengo un una contraseña y un hash</li><li>Lo desencripto con hashcat <strong>hashcat -m 3200 hash /usr/share/wordlists/rockyou.txt</strong></li><li>Obtengo el usuario <strong>admin:whatever1</strong></li><li>Puedo entrar en <strong>/admin.usage.htb/</strong></li><li>Tras buscar la unica forma que encuentro para subir un archivo y entrar al server sería a través de cambiar la foto del usuario</li><li>Si no tiene las reglas bien puestas puedo subir un archivo PHP acabado en .jpg <strong>(CVE-2023-24249)</strong> </li></ol><img src="images/39-1.png" alt="images/39-1.png" /><ol><li>Hay que enviar el archivo como .jpg e intercepar el tráfico. En Burpsuite le ponemos .php y se bypasseará </li></ol><img src="images/39-2.png" alt="images/39-2.png" /><ol><li>Busco la ruta del script gracias al botón de download   </li><li>Obtengo un rev shell </li></ol><img src="images/39-3.png" alt="images/39-3.png" /><ol><li>Encuentro el usuario <strong>xander</strong></li><li>Tengo que pivotar a <strong>xander</strong> y de xander pivotar a root</li><li>Dentro del directorio home de dash hay varios archivos ocultos</li><li>Encuentro una pass en el archivo<strong> .monitrc</strong></li><li>Es una pass para un usuario local</li><li>Pruebo a entrar por SSH con esa pass y el usuario xander y consigo una conexión </li></ol><img src="images/39-4.png" alt="images/39-4.png" /><ol><li>Veo que comandos puedo ejecutar como root </li></ol><img src="images/39-5.png" alt="images/39-5.png" /><ol><li>Puedo ver lo que hace usage_management con cat</li><li>7zip esta funcionando en <strong>/var/www/html</strong> y devolviendo en<strong> /var/backups</strong></li><li>Accedoa la ruta <strong>/var/www/html</strong></li><li>Uso la <strong>Wildcard</strong> de <strong>7z</strong> </li></ol><img src="images/39-6.png" alt="images/39-6.png" /></p><p align="center"></p></div>
</body>
</html>
