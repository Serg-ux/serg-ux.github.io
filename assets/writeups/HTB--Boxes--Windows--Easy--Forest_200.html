<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Forest</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="../../assets/css/writeups_style.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Forest</h1><br/><p>Portscan</p><p></p><p><img src="images/200-1.png" alt="images/200-1.png" /></p><p></p><p>I will enumerate ldap with the domain htb.local</p><p></p><p>	<strong>ldapsearch -x -H &#39;ldap://10.10.10.161&#39; -b&quot;dc=htb,dc=local&quot;</strong></p><p></p><p>A Domain Controller is a server responsible for managing network and identity security requests.</p><p></p><p>	<strong>ldapsearch -x -H &#39;ldap://10.10.10.161&#39; -b&quot;dc=htb,dc=local&quot; | grep &quot;svc-&quot;</strong></p><p>	</p><p><img src="images/200-2.png" alt="images/200-2.png" /></p><p></p><p>A service account used to run the services related to the platform.</p><p></p><p>request a TGT ticket and dump the hash.</p><p></p><p><img src="images/200-3.png" alt="images/200-3.png" /></p><p></p><p>With John we crack the hash</p><p></p><p><img src="images/200-4.png" alt="images/200-4.png" /></p><p></p><p>Port 5985 its open, so maybe we can connect remotly throught WINRM</p><p></p><p>I can connect as alfresco user and find the user.flag</p><p></p><p><img src="images/200-5.png" alt="images/200-5.png" /></p><p></p><p>For privilege scalation i will use bloodhound to visualize the domain and find a posible privilege scalation</p><p></p><p>	<strong>bloodhound-python -d htb.local -u &#39;svc-alfresco&#39; -p &#39;s3rvice&#39; -gc forest.htb.local -c all --zip -ns 10.10.10.161</strong></p><p>	</p><p><img src="images/200-6.png" alt="images/200-6.png" /></p><p></p><p>With BloodHound GUI i can see that alfresco is member of 9 groups</p><p></p><p><img src="images/200-7.png" alt="images/200-7.png" /></p><p></p><p>One of the paths shows that the Exchange Windows Permissions group has WriteDaclprivileges on the Domain. The WriteDACL privilege gives a user the ability to add ACLs to an object.</p><p></p><p><img src="images/200-8.png" alt="images/200-8.png" /></p><p></p><p>Add a new user to Exchange Windows Permissions as well as the Remote Management Users group.</p><p></p><p><img src="images/200-9.png" alt="images/200-9.png" /></p><p></p><p>It works</p><p></p><p><img src="images/200-10.png" alt="images/200-10.png" /></p><p></p><p>Now we need to download the PowerView script and import it into the current session.</p><p></p><p>The Bypass-4MSI command is used to evade defender before importing the script. Next, we can use the Add-ObjectACL with john&#39;s credentials, and give him DCSync rights.</p><p></p><p><img src="images/200-11.png" alt="images/200-11.png" /></p><p></p><p>we can use the Add-ObjectACL with our creds, and give him DCSync rights</p><p></p><p>DSYNC (Data Synchronization) is a file operation that ensures file data is written out synchronously</p><p></p><p><img src="images/200-12.png" alt="images/200-12.png" /></p><p></p><p>Now My user sergux has DCSync permissions, so i can dump user hashes from de DC.</p><p></p><p><img src="images/200-13.png" alt="images/200-13.png" /></p><p></p><p><img src="images/200-14.png" alt="images/200-14.png" /></p><p></p><p>Now we can use this NTLM hash with crackmapexec to perform a Pass the hash attack</p><p></p><p><img src="images/200-15.png" alt="images/200-15.png" /></p><p></p><p>We can execute commands with crackmapexec too</p><p></p><p>	<strong>crackmapexec smb &lt;IP&gt; -u &#39;Administrator&#39; -H &#39;NTML_HASH&#39; -d &#39;htb.local&#39; -x &quot;type C:\Users\Administrator\Desktop\root.txt&quot;</strong></p><p>	</p></div>
</body>
</html>
