<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Lantern</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="../../assets/css/writeups_style.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Lantern</h1><br/><p>Realizo un escaneo de puertos con NMAP</p><p><strong>nmap -sVC -p- --open -sS --min-rate 5000 -v -n -Pn -oN lantern_scan 10.10.11.29</strong></p><p></p><p>Nos redirige a una página </p><p><img src="images/122-1.png" alt="images/122-1.png" /></p><p></p><p>Añadimos el dominio</p><p><strong>nano /etc/hosts</strong></p><p></p><p>Tras un primer vistazo no encuentro nada interesante</p><p></p><p>Realizo un escaneo de subdominios sin éxito</p><p></p><p>El servidor usa Blazor. Blazor es .net por lo que puede que tenga un dll.</p><p></p><p>Hay una solicitud POST en /vacancies por lo que es posible que sea un SSRF, Solo acepta PDF</p><p><img src="images/122-2.png" alt="images/122-2.png" /></p><p></p><p>Encontramos que es vulnerable a SSRF via X-Skipper-Proxy</p><p><a href="https://www.exploit-db.com/exploits/51111">X-Skipper-Proxy v0.13.237 - Server Side Request Forgery (SSRF) - Multiple remote Exploit (exploit-db.com)</a></p><p>Esto nos permite leer archivos locales dentro del servidor</p><p></p><p><img src="images/122-3.png" alt="images/122-3.png" /></p><p></p><p>Interceptamos la solicitud GET con Burpsuite y la modificamos para poder hacer el SSRF</p><p><img src="images/122-4.png" alt="images/122-4.png" /></p><p></p><p><img src="images/122-5.png" alt="images/122-5.png" /></p><p></p><p>Buscamos puertos internos con FFUF</p><p><strong>ffuf -u </strong><strong><a href="http://lantern.htb/">http://lantern.htb/</a></strong><strong> -H &quot;X-Skipper-Proxy: </strong><strong><a href="http://localhost:FUZZ">http://localhost:FUZZ</a></strong><strong>&quot; -w /usr/share/seclists/Discovery/Infrastructure/common-http-ports.txt </strong></p><p><img src="images/122-6.png" alt="images/122-6.png" /></p><p></p><p>En nuestro SSRF cambiamos al puerto 5000</p><p><img src="images/122-7.png" alt="images/122-7.png" /></p><p></p><p><img src="images/122-8.png" alt="images/122-8.png" /></p><p>Seguiremos usando este puerto interno</p><p></p><p>Encontramos una script</p><p><img src="images/122-9.png" alt="images/122-9.png" /></p><p></p><p>Metemos este archivo en la URL</p><p><img src="images/122-10.png" alt="images/122-10.png" /></p><p></p><p>Lo cual nos devuelve la script</p><p>Si nos fijamos encontraremos que se menciona un archibo .json el cual dice que incluye las crendeciales</p><p><img src="images/122-11.png" alt="images/122-11.png" /></p><p></p><p>Redirijimos la ruta del SSRF</p><p><img src="images/122-12.png" alt="images/122-12.png" /></p><p></p><p>Lo cual nos devuelve un montón de .dll</p><p><img src="images/122-13.png" alt="images/122-13.png" /></p><p></p><p>El dll que nos interesa será este, el cual tiene pinta que tendrá las credenciales</p><p><img src="images/122-14.png" alt="images/122-14.png" /></p><p></p><p>Hacemos la solicitud en el buscador para poder descargar el archivo InternaLantern.dll</p><p><img src="images/122-15.png" alt="images/122-15.png" /></p><p>Para que nos pille bien la solicitud hay que escribir exactamente el nombre del archivo</p><p><img src="images/122-16.png" alt="images/122-16.png" /></p><p></p><p>Se nos descarga el .dll</p><p><img src="images/122-17.png" alt="images/122-17.png" /></p><p></p><p>Para poder decompilar el archivo usaremos dotPeek, Un decompilador .NET</p><p><img src="images/122-18.png" alt="images/122-18.png" /></p><p></p><p>Encontramos la una password cifrada a Base64</p><p></p><p>La desciframos y nos da el usuario admin con su respectiva password</p><p><strong>admin:AJbFA_Q@925p9ap#22</strong></p><p></p><p>Estas creds es muy probable que tengamos que meterlas en el login panel del puerto 3000</p><p><img src="images/122-19.png" alt="images/122-19.png" /></p><p></p><p>A primera vista puedo ver que hay una sección para subir contenido</p><p><img src="images/122-20.png" alt="images/122-20.png" /></p><p></p><p>Y que podemos ver los archivos, desde la carpeta Files, app.py</p><p>Veo que desde la ruta /PrivacyAndPolicy puedo acceder a archivos locales (LFI)</p><p><img src="images/122-21.png" alt="images/122-21.png" /></p><p></p><p>Realizo la Solicitud GET para el LFI</p><p><img src="images/122-22.png" alt="images/122-22.png" /></p><p></p><p><img src="images/122-23.png" alt="images/122-23.png" /></p><p></p><p>Encontramos al usuario tomas</p><p><img src="images/122-24.png" alt="images/122-24.png" /></p><p></p><p>Dentro de Upload Content podemos buscar un modulo</p><p>Voy a intentar ver si puedo salir del directorio en el que busca</p><p><img src="images/122-25.png" alt="images/122-25.png" /></p><p>Esto nos da info de que tenemos que subir un archivo .dll</p><p></p><p>Buscando en Logs.dll encontramos el archivo FileUpload.dll</p><p><img src="images/122-26.png" alt="images/122-26.png" /></p><p><img src="images/122-27.png" alt="images/122-27.png" /></p><p>Este archivo tiene un bug el cual permite subir archivos en /opt/components</p><p></p><p>Por lo cual tendremos que crear o descargar y modifcar un .dll para obtener el id_rsa del usuario y poder conectarnos</p><p></p><p>Creamos el .dll</p><p><img src="images/122-28.png" alt="images/122-28.png" /></p><p></p><p>Modificamos el Class1.dll añadiendo la ruta del id_rsa de tomas</p><p><h3> </h3><strong><h3>str1 = new StreamReader((Stream) new MemoryStream(File.ReadAllBytes(&quot;/home/tomas/.ssh/id_rsa&quot;)), Encoding.UTF8, true).ReadToEnd();</h3></strong></p><p> </p><p> Subimos el archivo y interceptamos la request con Burpsuite</p><p> </p><p> Esto nos dará el id_rsa</p><p> </p><p> Nos conectamos a través de SSH</p><p> <img src="images/122-29.png" alt="images/122-29.png" /></p><p> </p><p> Obtenemos la flag del user.txt</p><p> </p><p> Para la escalada de privilegios hago sudo -l para ver que comandos puedo ejecutar como root</p><p> Veo que puedo ejecutar un comando</p><p><img src="images/122-30.png" alt="images/122-30.png" /></p><p></p><p> Con <strong>ps aux | grep root</strong> vemos los servicios ejecutados como root</p><p> <img src="images/122-31.png" alt="images/122-31.png" /></p><p> Encontramos la script automation.sh</p><p> </p><p> Ejecutamos el comando procmon </p><p><img src="images/122-32.png" alt="images/122-32.png" /></p><p></p><p>Dejamos que capture eventos</p><p><img src="images/122-33.png" alt="images/122-33.png" /></p><p></p><p>Y hacemos CTRL+C Para guardar</p><p><img src="images/122-34.png" alt="images/122-34.png" /></p><p></p><p>Es una db de SQLite</p><p><img src="images/122-35.png" alt="images/122-35.png" /></p><p></p><p>Tranferimos esta db a nuestra máquina local</p><p><img src="images/122-36.png" alt="images/122-36.png" /></p><p></p><p><img src="images/122-37.png" alt="images/122-37.png" /></p><p></p><p>Dentro de este archivo obtenemos la pass de root</p><p></p><p>Accedemos al user root y obtenemos la flag root.txt</p><p></p><p></p></div>
</body>
</html>
